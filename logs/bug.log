docker buildx prune -f
Total:	0B
docker --version
Docker version 24.0.6, build ed223bc
docker buildx version
github.com/docker/buildx v0.11.2 9872040
docker buildx build --progress plain --load -t naftulikay/docker-buildx-race-condition:latest \
	-f Dockerfile ./
#0 building with "priceless_sanderson" instance using docker-container driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 1.70kB done
#1 DONE 0.2s

#2 [internal] load metadata for docker.io/library/node:18-alpine
#2 DONE 2.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 54B done
#3 DONE 0.2s

#4 [internal] load build context
#4 DONE 0.0s

#5 [builder 1/7] FROM docker.io/library/node:18-alpine@sha256:a315556d82ef54561e54fca7d8ee333382de183d4e56841dcefcd05b55310f46
#5 resolve docker.io/library/node:18-alpine@sha256:a315556d82ef54561e54fca7d8ee333382de183d4e56841dcefcd05b55310f46
#5 resolve docker.io/library/node:18-alpine@sha256:a315556d82ef54561e54fca7d8ee333382de183d4e56841dcefcd05b55310f46 0.1s done
#5 DONE 0.1s

#5 [builder 1/7] FROM docker.io/library/node:18-alpine@sha256:a315556d82ef54561e54fca7d8ee333382de183d4e56841dcefcd05b55310f46
#5 ...

#4 [internal] load build context
#4 transferring context: 10.62kB done
#4 DONE 0.5s

#5 [builder 1/7] FROM docker.io/library/node:18-alpine@sha256:a315556d82ef54561e54fca7d8ee333382de183d4e56841dcefcd05b55310f46
#5 sha256:fdef87f136ff3e0ba0d622cf3a573aebe6891d240d7dd55799ac0fd30a706db4 453B / 453B 0.2s done
#5 sha256:76c34934b3319c116bffd4685ee2bcb032298ccce64b89b7081ec18ffdbd6175 0B / 2.34MB 0.2s
#5 sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa 0B / 3.40MB 0.2s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 0B / 47.91MB 0.2s
#5 sha256:76c34934b3319c116bffd4685ee2bcb032298ccce64b89b7081ec18ffdbd6175 1.05MB / 2.34MB 0.6s
#5 sha256:76c34934b3319c116bffd4685ee2bcb032298ccce64b89b7081ec18ffdbd6175 2.34MB / 2.34MB 0.7s done
#5 sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa 1.05MB / 3.40MB 1.8s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 3.15MB / 47.91MB 2.0s
#5 sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa 2.10MB / 3.40MB 2.4s
#5 sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa 3.15MB / 3.40MB 2.7s
#5 sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa 3.40MB / 3.40MB 2.9s done
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 6.29MB / 47.91MB 2.9s
#5 extracting sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa
#5 extracting sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa 0.1s done
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 9.44MB / 47.91MB 3.5s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 12.58MB / 47.91MB 4.2s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 15.73MB / 47.91MB 4.7s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 18.87MB / 47.91MB 5.1s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 22.02MB / 47.91MB 5.7s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 25.17MB / 47.91MB 6.2s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 28.31MB / 47.91MB 6.8s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 31.46MB / 47.91MB 7.4s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 34.60MB / 47.91MB 7.8s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 37.75MB / 47.91MB 8.3s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 40.89MB / 47.91MB 9.2s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 44.04MB / 47.91MB 9.8s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 47.19MB / 47.91MB 10.4s
#5 sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 47.91MB / 47.91MB 10.5s done
#5 extracting sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7
#5 extracting sha256:824de1d006d492e037a03312c272427b62e171607bc6fb0e7db991b2eda190b7 0.9s done
#5 DONE 12.3s

#5 [builder 1/7] FROM docker.io/library/node:18-alpine@sha256:a315556d82ef54561e54fca7d8ee333382de183d4e56841dcefcd05b55310f46
#5 extracting sha256:76c34934b3319c116bffd4685ee2bcb032298ccce64b89b7081ec18ffdbd6175 0.1s done
#5 DONE 12.5s

#5 [builder 1/7] FROM docker.io/library/node:18-alpine@sha256:a315556d82ef54561e54fca7d8ee333382de183d4e56841dcefcd05b55310f46
#5 extracting sha256:fdef87f136ff3e0ba0d622cf3a573aebe6891d240d7dd55799ac0fd30a706db4 0.1s done
#5 DONE 12.6s

#6 [builder 2/7] RUN install -d -m 0755 /usr/src/app
#6 DONE 0.8s

#7 [builder 3/7] WORKDIR /usr/src/app
#7 DONE 0.3s

#8 [stage-1 4/8] RUN echo "*** cache id: com.github.naftulikay.my-repo.node-modules.v1"
#8 0.359 *** cache id: com.github.naftulikay.my-repo.node-modules.v1
#8 ...

#9 [builder 4/7] COPY ./package.json ./package-lock.json ./
#9 DONE 0.4s

#8 [stage-1 4/8] RUN echo "*** cache id: com.github.naftulikay.my-repo.node-modules.v1"
#8 DONE 0.6s

#10 [builder 5/7] RUN echo "*** cache id: com.github.naftulikay.my-repo.node-modules.v1"
#10 0.525 *** cache id: com.github.naftulikay.my-repo.node-modules.v1
#10 DONE 0.6s

#11 [stage-1 5/8] RUN --mount=type=cache,sharing=locked,id=com.github.naftulikay.my-repo.node-modules.v1,target=/builder/node_modules cp -r /builder/node_modules ./
#11 DONE 0.9s

#12 [builder 6/7] RUN --mount=type=cache,sharing=locked,id=com.github.naftulikay.my-repo.node-modules.v1,target=/usr/src/app/node_modules     rm -fr node_modules/* &&     npm install
#12 1.715 
#12 1.715 added 23 packages, and audited 24 packages in 980ms
#12 1.715 
#12 1.715 4 packages are looking for funding
#12 1.715   run `npm fund` for details
#12 1.716 
#12 1.716 found 0 vulnerabilities
#12 1.717 npm notice 
#12 1.717 npm notice New major version of npm available! 9.8.1 -> 10.1.0
#12 1.717 npm notice Changelog: <https://github.com/npm/cli/releases/tag/v10.1.0>
#12 1.717 npm notice Run `npm install -g npm@10.1.0` to update!
#12 1.717 npm notice 
#12 DONE 1.8s

#13 [builder 7/7] COPY ./index.js ./
#13 DONE 0.4s

#14 [stage-1 6/8] COPY --from=builder /usr/src/app/index.js ./
#14 DONE 0.3s

#15 [stage-1 7/8] COPY utils/sanity.sh ./
#15 DONE 0.3s

#16 [stage-1 8/8] RUN ./sanity.sh --clean
#16 0.334 *** ERROR: node modules were not copied over, directory empty
#16 ERROR: process "/bin/sh -c ./sanity.sh --clean" did not complete successfully: exit code: 1
------
 > [stage-1 8/8] RUN ./sanity.sh --clean:
0.334 *** ERROR: node modules were not copied over, directory empty
------
Dockerfile:48
--------------------
  46 |     # sanity test
  47 |     COPY utils/sanity.sh ./
  48 | >>> RUN ./sanity.sh --clean
  49 |     
  50 |     CMD ["index"]
--------------------
ERROR: failed to solve: process "/bin/sh -c ./sanity.sh --clean" did not complete successfully: exit code: 1
make: *** [Makefile:19: demo] Error 1
